<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Phaser Spaceship Prototype</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000000;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
</head>
<body>
    <script>
        class GameScene extends Phaser.Scene {
            constructor() {
                super('GameScene');
            }

            preload() {
                // Create particle texture for trails
                this.createParticleTexture();
            }

            create() {
                // Initialize game properties
                this.setupGameVariables();
                
                // Create game elements
                this.createStarfield();
                this.createSpaceship();
                this.createTrailEmitter();
                
                // Set up input handlers
                this.setupInputHandlers();
                
                // Handle window resize
                this.scale.on('resize', this.handleResize, this);
            }

            update() {
                // Update game elements
                this.updateStarfield();
                this.updateSpaceshipPosition();
                this.updateTrailEmitter();
            }
            
            setupGameVariables() {
                // Game state variables
                this.touchActive = false;
                this.touchStartPoint = { x: 0, y: 0 };
                this.defaultY = this.cameras.main.height / 2;
                this.targetY = this.defaultY;
                this.targetAngle = 0;
                this.lerpFactor = 0.1; // Movement smoothness (0-1)
                
                // Movement boundaries (restrict to middle 80% of screen)
                this.movementBounds = {
                    upper: this.cameras.main.height * 0.1,
                    lower: this.cameras.main.height * 0.9
                };
            }
            
            createParticleTexture() {
                // Create custom particle texture for the trail effect
                const graphics = this.make.graphics({ x: 0, y: 0, add: false });
                graphics.fillStyle(0xffffff);
                graphics.fillCircle(4, 4, 4);
                graphics.generateTexture('particle', 8, 8);
                graphics.destroy();
            }
            
            createStarfield() {
                // Create two star layers for parallax effect
                this.backgroundStars1 = this.add.group();
                this.backgroundStars2 = this.add.group();
                
                // Create distant stars (slower moving)
                for (let i = 0; i < 100; i++) {
                    const x = Phaser.Math.Between(0, this.cameras.main.width);
                    const y = Phaser.Math.Between(0, this.cameras.main.height);
                    const size = Phaser.Math.Between(1, 2);
                    const alpha = Phaser.Math.FloatBetween(0.2, 0.5);
                    
                    const star = this.add.circle(x, y, size, 0xffffff, alpha);
                    this.backgroundStars1.add(star);
                }
                
                // Create closer stars (faster moving)
                for (let i = 0; i < 50; i++) {
                    const x = Phaser.Math.Between(0, this.cameras.main.width);
                    const y = Phaser.Math.Between(0, this.cameras.main.height);
                    const size = Phaser.Math.Between(1, 3);
                    const alpha = Phaser.Math.FloatBetween(0.5, 1);
                    
                    const star = this.add.circle(x, y, size, 0xffffff, alpha);
                    this.backgroundStars2.add(star);
                }
            }
            
            createSpaceship() {
                // Create spaceship graphics
                const graphics = this.make.graphics({ x: 0, y: 0, add: false });
                
                // Draw gray oval body
                graphics.fillStyle(0x888888); // Gray color for main body
                graphics.fillEllipse(30, 15, 60, 30);
                
                // Draw red front to indicate direction
                graphics.fillStyle(0xff0000); // Red color for front
                graphics.fillEllipse(45, 15, 30, 15);
                
                // Generate texture from graphics
                graphics.generateTexture('spaceship', 60, 30);
                graphics.destroy();
                
                // Create spaceship sprite
                this.spaceship = this.physics.add.sprite(
                    this.cameras.main.width * 0.2, 
                    this.defaultY, 
                    'spaceship'
                );
                this.spaceship.setOrigin(0.5, 0.5);
            }
            
            createTrailEmitter() {
                // Create particle manager
                this.particles = this.add.particles('particle');
                
                // Configure trail emitter
                this.trailEmitter = this.particles.createEmitter({
                    lifespan: { min: 200, max: 400 },
                    speed: { min: 50, max: 150 },
                    angle: 180,
                    scale: { start: 0.6, end: 0 },
                    blendMode: 'ADD',
                    tint: [ 0xff8800, 0xff4400, 0xff0000 ],
                    alpha: { start: 0.8, end: 0 },
                    on: false,
                    frequency: 20
                });
            }
            
            setupInputHandlers() {
                // Touch and mouse down handler
                this.input.on('pointerdown', (pointer) => {
                    this.touchActive = true;
                    this.touchStartPoint.x = pointer.x;
                    this.touchStartPoint.y = pointer.y;
                    this.trailEmitter.start();
                });
                
                // Touch and mouse move handler
                this.input.on('pointermove', (pointer) => {
                    if (this.touchActive) {
                        // Calculate vertical movement
                        const offsetY = pointer.y - this.touchStartPoint.y;
                        this.targetY = Phaser.Math.Clamp(
                            this.defaultY + offsetY,
                            this.movementBounds.upper,
                            this.movementBounds.lower
                        );
                        
                        // Calculate rotation based on offset vector
                        const offsetX = pointer.x - this.touchStartPoint.x;
                        if (offsetX !== 0 || offsetY !== 0) {
                            this.targetAngle = Math.atan2(offsetY, offsetX);
                        }
                    }
                });
                
                // Touch and mouse up handler
                this.input.on('pointerup', () => {
                    this.touchActive = false;
                    this.targetY = this.defaultY; // Return to center
                    this.targetAngle = 0; // Return to forward direction
                    this.trailEmitter.stop();
                });
                
                // Handle losing focus
                this.game.events.on('blur', () => {
                    this.touchActive = false;
                    this.targetY = this.defaultY;
                    this.targetAngle = 0;
                    this.trailEmitter.stop();
                });
            }
            
            handleResize(gameSize) {
                // Update game elements when window is resized
                this.cameras.resize(gameSize.width, gameSize.height);
                
                // Update movement boundaries
                this.defaultY = gameSize.height / 2;
                if (!this.touchActive) {
                    this.targetY = this.defaultY;
                }
                
                this.movementBounds = {
                    upper: gameSize.height * 0.1,
                    lower: gameSize.height * 0.9
                };
                
                // Update spaceship horizontal position
                this.spaceship.x = gameSize.width * 0.2;
                
                // Redistribute stars
                this.redistributeStars(gameSize);
            }
            
            redistributeStars(gameSize) {
                // Redistribute background stars when screen is resized
                this.backgroundStars1.getChildren().forEach(star => {
                    if (star.x > gameSize.width) {
                        star.x = Phaser.Math.Between(0, gameSize.width);
                    }
                    if (star.y > gameSize.height) {
                        star.y = Phaser.Math.Between(0, gameSize.height);
                    }
                });
                
                this.backgroundStars2.getChildren().forEach(star => {
                    if (star.x > gameSize.width) {
                        star.x = Phaser.Math.Between(0, gameSize.width);
                    }
                    if (star.y > gameSize.height) {
                        star.y = Phaser.Math.Between(0, gameSize.height);
                    }
                });
            }
            
            updateStarfield() {
                // Update distant stars (slow movement)
                this.backgroundStars1.getChildren().forEach(star => {
                    star.x -= 0.5; // Slow scroll speed
                    
                    // Reset star position when it goes off-screen
                    if (star.x < 0) {
                        star.x = this.cameras.main.width;
                        star.y = Phaser.Math.Between(0, this.cameras.main.height);
                    }
                });
                
                // Update closer stars (faster movement)
                this.backgroundStars2.getChildren().forEach(star => {
                    star.x -= 2; // Faster scroll speed
                    
                    // Reset star position when it goes off-screen
                    if (star.x < 0) {
                        star.x = this.cameras.main.width;
                        star.y = Phaser.Math.Between(0, this.cameras.main.height);
                    }
                });
            }
            
            updateSpaceshipPosition() {
                // Smooth lerp to target Y position
                this.spaceship.y = Phaser.Math.Linear(
                    this.spaceship.y, 
                    this.targetY, 
                    this.lerpFactor
                );
                
                // Smooth lerp to target rotation
                this.spaceship.rotation = Phaser.Math.Linear(
                    this.spaceship.rotation, 
                    this.targetAngle, 
                    this.lerpFactor
                );
            }
            
            updateTrailEmitter() {
                if (this.trailEmitter.active) {
                    // Calculate position at rear of spaceship based on current rotation
                    const rearX = this.spaceship.x - 30 * Math.cos(this.spaceship.rotation);
                    const rearY = this.spaceship.y - 30 * Math.sin(this.spaceship.rotation);
                    
                    // Update emitter position and angle
                    this.trailEmitter.setPosition(rearX, rearY);
                    this.trailEmitter.setAngle({
                        min: (this.spaceship.rotation * 180 / Math.PI) + 170,
                        max: (this.spaceship.rotation * 180 / Math.PI) + 190
                    });
                }
            }
        }

        // Main game configuration
        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            backgroundColor: '#000000',
            physics: {
                default: 'arcade',
                arcade: {
                    debug: false,
                    gravity: { x: 0, y: 0 }
                }
            },
            scene: [GameScene],
            scale: {
                mode: Phaser.Scale.RESIZE,
                autoCenter: Phaser.Scale.CENTER_BOTH
            }
        };

        // Initialize the game
        const game = new Phaser.Game(config);
    </script>
</body>
</html>